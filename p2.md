Посмотри на tools/list в src/core/web/server-http.ts
в функцию getTools() передаются дополнительные параметры (transport, headers, payload).
Они "доезжают" до вызова функции toolsOrFn в src/core/utils/utils.ts
в случае, если __MCP_PROJECT_DATA__.tools является асинхронной функцией.

Вот так же надо сделать для получения списка промптов: resources/list, 
протащив дополнительные параметры (transport, headers, payload) через getResourcesList до customResources в McpServerData.customResources) и
сделать, что customResources может быть не только массивом IResourceData[], но и асинхронной функцией, возвращающей промисс IResourceData[].
Позаботься обо всех местах, где упоминается customResources.

Прежде чем приступать к модификации кода напиши в фалке p3.md в корне проекта подробный план действий.
Где что как планируешь изменить. (расписывать по шагам и давать оценку затрат не нужно)
Для примера смотри план p.md
─
